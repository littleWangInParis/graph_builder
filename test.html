<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Scatter Plot Matrix in Table</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
      table {
        border-collapse: collapse;
        /* margin: 20px auto; */
      }
      td {
        border: 0px;
        padding: 0px;
      }
      svg {
        background: white;
      }
      .dot {
        fill: steelblue;
        opacity: 0.7;
      }
      .axis path,
      .axis line {
        stroke: #999;
        shape-rendering: crispEdges;
      }
      /* 这个非常重要 */
      svg {
        display: block;
      }
    </style>
  </head>
  <body>
    <table>
      <tr>
        <td><svg id="svg1" width="300" height="300"></svg></td>
        <td><svg id="svg2" width="300" height="300"></svg></td>
      </tr>
      <tr>
        <td><svg id="svg3" width="300" height="300"></svg></td>
        <td><svg id="svg4" width="300" height="300"></svg></td>
      </tr>
    </table>

    <script>
      const data = d3.range(100).map(() => ({
        Var1: Math.random() * 100,
        Var2: Math.random() * 100,
        Var3: Math.random() * 100,
        Var4: Math.random() * 100,
      }))

      const pairs = [
        ['Var1', 'Var2'],
        ['Var1', 'Var3'],
        ['Var2', 'Var3'],
        ['Var2', 'Var4'],
      ]

      const size = 300
      const margin = { top: 0, right: 0, bottom: 0, left: 0 }
      const innerWidth = size - margin.left - margin.right
      const innerHeight = size - margin.top - margin.bottom

      pairs.forEach(([xVar, yVar], i) => {
        const svg = d3.select(`#svg${i + 1}`)
        const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)

        const x = d3
          .scaleLinear()
          .domain(d3.extent(data, d => d[xVar]))
          .nice()
          .range([0, innerWidth])

        const y = d3
          .scaleLinear()
          .domain(d3.extent(data, d => d[yVar]))
          .nice()
          .range([innerHeight, 0])

        // X Axis
        g.append('g').attr('transform', `translate(0,${innerHeight})`)
        .call(d3.axisBottom(x).ticks(5));

        // Y Axis
        g.append('g')
        .call(d3.axisLeft(y).ticks(5));

        // Dots
        g.selectAll('circle')
          .data(data)
          .join('circle')
          .attr('class', 'dot')
          .attr('cx', d => x(d[xVar]))
          .attr('cy', d => y(d[yVar]))
          .attr('r', 3)
      })
    </script>
  </body>
</html>
